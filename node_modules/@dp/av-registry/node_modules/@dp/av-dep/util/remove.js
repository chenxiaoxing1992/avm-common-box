var UglifyJS = require("uglify-js");
var EXTERNALS_KEY = "externals";
var WEBPACK_KEY = "webpack";
var transformer = function(opts){
	return new UglifyJS.TreeTransformer(null, function(node){
	   if(node instanceof UglifyJS.AST_Call && node.expression.name == WEBPACK_KEY ){
	   		var webpackArgs = node.args[0].properties;
	   		webpackArgs.some(function(item,index){
	   			if(item.key == EXTERNALS_KEY){
	   				var  externalsArgs= item.value.properties;
	   				externalsArgs.some(function(it,id){
	   					if(it.key == opts.key){
	   						externalsArgs.splice(id,1);
	   						return true;
	   					}
	   					return false;
	   				})
	   				return true;
	   			}
	   			return false;
	   		})
	   		return node;
	   	}
	});
}

module.exports = function(content,opts){
	var ast = UglifyJS.parse(content);
	var ast2 = ast.transform(transformer(opts));
	return ast2.print_to_string({ beautify: true });
}